---
layout: post
category : 数据库
title: 'Mysql5.1参考手册摘录05'
tagline: ""
tags : [数据库, Mysql]
---

* auto-gen TOC:
{:toc}

## 第6章：MySQL中的复制

### 6.1. 复制介绍

> MySQL支持单向、异步复制，复制过程中一个服务器充当主服务器，而一个或多个其它服务器充当从服务器。

主服务器将更新写入二进制日志文件，并维护文件的一个索引以跟踪日志循环。这些日志可以记录发送到从服务器的更新。当一个从服务器连接主服务器时，它通知主服务器从服务器在日志中读取的最后一次成功更新的位置。从服务器接收从那时起发生的任何更新，然后封锁并等待主服务器通知新的更新。

<!--break-->

单向复制有利于健壮性、速度和系统管理：

- 主服务器/从服务器设置增加了健壮性。主服务器出现问题时，你可以切换到从服务器作为备份。

- 通过在主服务器和从服务器之间切分处理客户查询的负荷，可以得到更好的客户响应时间。

-  使用复制的另一个好处是可以使用一个从服务器执行备份，而不会干扰主服务器。在备份过程中主服务器可以继续处理更新。

SELECT**查询可以发送到从服务器以降低主服务器的查询处理负荷**。但**修改数据的语句仍然应发送到主服务器**，以便主服务器和从服务器保持同步。如果非更新查询为主，该负载均衡策略很有效，但一般是更新查询。

### 6.2. 复制实施概述

MySQL复制基于主服务器在二进制日志中跟踪所有对数据库的更改(更新、删除等等)。

要进行复制，必须在主服务器上启用二进制日志。

每个从服务器从主服务器接收主服务器已经记录到其二进制日志的保存的更新，以便从服务器可以对其数据拷贝执行相同的更新。

**二进制日志只是一个从启用二进制日志的固定时间点开始的记录。**

将主服务器的数据拷贝到从服务器的一个途径是使用LOAD DATA FROM MASTER语句。

注意：LOAD DATA FROM MASTER目前只在所有表使用MyISAM存储引擎的主服务器上工作。并且，该语句将获得**全局读锁定**，因此当表正复制到从服务器上时，不可能在主服务器上进行更新。

### 6.3. 复制实施细节

MySQL使用3个线程来执行复制功能(其中1个在主服务器上，另两个在从服务器上。)

- 当发出START SLAVE时，从服务器创建一个I/O线程，以连接主服务器并让它发送记录在其二进制日志中的语句。

- 主服务器创建一个线程将二进制日志中的内容发送到从服务器。该线程可以识别为主服务器上SHOW PROCESSLIST的输出中的Binlog Dump线程。

- 从服务器I/O线程读取主服务器Binlog Dump线程发送的内容并将该数据拷贝到从服务器数据目录中的本地文件中，即中继日志。

- 第3个线程是SQL线程，是从服务器创建用于读取中继日志并执行日志中包含的更新。

SHOW PROCESSLIST语句可以提供在主服务器上和从服务器上发生的关于复制的信息。

#### 6.3.1. 复制主线程状态

#### 6.3.2. 复制从I/O线程状态

#### 6.3.3. 复制从SQL线程状态

#### 6.3.4. 复制传递和状态文件

内容目前理解不了，先留个记号，以后需要再看！